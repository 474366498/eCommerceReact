const defaultAdviceState = {
   cartList : [
      {
         "brandId":"2285766",
         "brandName":"Guess官方旗舰店",
         "brandShowName":"GUESS",
         "brandStoreSn":"10000085",
         "couponDisabled":1,
         "fallingTagSn":"",
         "image3":"http://a.vpimg4.com/upload/merchandise/pdc/103/838/921020554838103/2/YI2K9416KWHT-3.jpg",
         "image7":"http://a.vpimg3.com/upload/merchandise/pdc/103/838/921020554838103/2/YI2K9416KWHT-7.jpg" ,
         "isHaiTao":0   ,
         "isIndependent":0 ,
         "isLoginAddCart":0   ,
         "isMedicine":0 ,
         "isMixSaleStyle":0,
         "isMultiColor":1,
         "isNuke":0,
         "isPreSale":0,
         "isPrepay":0,
         "isWarmup":0,
         "marketPrice":"299",
         "multiColorNum":2,
         "newCatId":"314",
         "preferSquare":0,
         "priceIconType":0,
         "productId":"434850655",
         "productName":" 情侣款2018新款女士倒三角LOGO短袖T恤",
         "promotionPriceType":0,
         "saleStyle":16,
         "sellTimeFrom":"1494490864",
         "sellTimeTo":"1567239666",
         "sendByVendor":0,
         "showPriceType":0,
         "skuId":"72415664639475952",
         "smallImage":"http://a.vpimg3.com/upload/merchandise/pdcimg/2018/12/05/36/252473901543993862664_5t.jpg",
         "squareImage":"http://a.vpimg4.com/upload/merchandise/pdcimg/2018/12/05/174/182707491543993861930.jpg",
         "subTitle":"此款服装版型标准，建议按日常穿着尺码选择。",
         "type":0,
         "vSpuId":"72415664639475729",
         "vipDiscount":"4.5折",
         "vipShopSize":[
            {"t": "XS", "c": false},
            {"t": "X", "c": false}
         ],       //自定义字段
         "vipShopColor":[
            {"t": "绿色", "c": false, "bg": "green"},
            {"t": "红色", "c": false, "bg": "red"}
         ],      //自定义字段
         "vipShopNumber":2,      //自定义字段
         "vipshopPrice":"134",
         "vipshopPriceSuff":""
      },
      {
         "brandId":"3705143",
         "brandName":"伊芙丽eifini年终嗨购专场",
         "brandShowName":"伊芙丽",
         "brandStoreSn":"10007290",
         "couponDisabled":1,
         "fallingTagSn":"",
         "icons":[
            {    
               "id":0,
               "image":"http://a.vpimg4.com/upload/category/2017/10/23/141/8b4fc78c-4fac-43b9-b333-f1f0c7fc150c.png",
               "name":null,
               "sort":0
            }
         ],
         "isHaiTao":0,
         "isIndependent":0,
         "isLoginAddCart":0,
         "isMedicine":0,
         "isMixSaleStyle":0,
         "isMultiColor":0,
         "isNuke":0,
         "isPreSale":0,
         "isPrepay":0,
         "isWarmup":0,
         "marketPrice":"698",
         "multiColorNum":1,
         "newCatId":"314",
         "preferSquare":0,
         "priceIconType":0,
         "productId":"719739956",
         "productName":"长袖休闲小上衣",
         "promotionPriceType":0,
         "saleStyle":3,
         "sellTimeFrom":"1544925600",
         "sellTimeTo":"1546653599",
         "sendByVendor":0,
         "showPriceType":0,
         "skuId":"439740557034348577",
         "smallImage":"http://a.vpimg3.com/upload/merchandise/pdcvis/2018/08/14/135/566c0d83-9176-47da-be25-ec886109c8a2_5t.jpg",
         "squareImage":"http://a.vpimg4.com/upload/merchandise/pdcvis/2018/08/14/105/40abc566-2dfc-4d20-a767-678020cde91b.jpg",
         "subTitle":"",
         "type":0,
         "vSpuId":"439740557034344540",
         "vipDiscount":"3.6折",
         "vipShopSize":[
            {"t": "XS", "c": false}
         ],       // 自定义字段
         "vipShopColor":[
            {"t": "绿色", "c": false, "bg": "green"}
         ],      // 自定义字段
         "vipShopNumber":1,      // 自定义字段
         "vipshopPrice":"251",
         "vipshopPriceSuff":""
      },
      {
         "brandId":"3682295" ,
         "brandName":"HLA海澜之家演绎冬日时尚专场 " ,
         "brandShowName":"HLA海澜之家" ,
         "brandStoreSn":"10020427" ,
         "couponDisabled":1 ,
         "fallingTagSn":"" ,
         "icons":[
            {
               "id":0,
               "image":"http://a.vpimg4.com/upload/category/2017/10/23/141/8b4fc78c-4fac-43b9-b333-f1f0c7fc150c.png",
               "name":null,
               "sort":0
            }
         ] ,
         "isHaiTao":0 ,
         "isIndependent":0 ,
         "isLoginAddCart":0 ,
         "isMedicine":0 ,
         "isMixSaleStyle":0 ,
         "isMultiColor":0 ,
         "isNuke":0 ,
         "isPreSale":0 ,
         "isPrepay":0 ,
         "isWarmup":0 ,
         "marketPrice":"" ,
         "multiColorNum":1 ,
         "newCatId":"340" ,
         "preferSquare":0 ,
         "priceIconType":0 ,
         "productId":"718119000" ,
         "productName":"2019夏季新款男士净色简约圆领绣标款短袖T恤" ,
         "promotionPriceType":0 ,
         "saleStyle":3 ,
         "sellTimeFrom":"1544184000" ,
         "sellTimeTo":"1547049600" ,
         "sendByVendor":0 ,
         "showPriceType":0 ,
         "skuId":"803124803176235008" ,
         "smallImage":"http://a.vpimg4.com/upload/merchandise/pdcvop/00133120/10020427/1899297663-803124803176230936-803124803176235009-50_5t.jpg" ,
         "squareImage":"http://a.vpimg2.com/upload/merchandise/pdcvop/00133120/10020427/953600107-803124803176230936-803124803176235009-1.jpg" ,
         "subTitle":"男款休闲短袖T恤，穿着舒适，亲肤质感，适用于日常休闲穿着" ,
         "type":0 ,
         "vSpuId":"803124803176230936" ,
         "vipDiscount":"一口价" ,
         "vipShopSize":[
            {"t": "XS", "c": false}
         ],
         "vipShopColor":[
            {"t": "绿色", "c": false, "bg": "green"}
         ],
         "vipShopNumber":1,
         "vipshopPrice":"58" ,
         "vipshopPriceSuff":""
      }
   ]
}

const AdviceReduce = (state = defaultAdviceState,action) => {
   switch(action.type) {
      case 'wareNumberIncrease' :
         let  index = action.index ,
            num = action.num ,
            cart =state.cartList;
         cart[index].vipShopNumber = num ;
         cart[index].vipShopColor.push(cart[index].vipShopColor[cart[index].vipShopColor.length - 1 ]);
         cart[index].vipShopSize.push(cart[index].vipShopSize[cart[index].vipShopSize.length - 1]);

         return Object.assign({},state,{
            cartList : [
               ...cart
            ]
         }) 
      break;
      case 'wareNumberReduce':
            index = action.index,
            num = action.num,
            cart = state.cartList ;
         cart[index].vipShopNumber = num ;
         cart[index].vipShopColor.pop();
         cart[index].vipShopSize.pop();
         return Object.assign({},state,{
            cartList : [
               ...cart
            ]
         }) ;
      break ;  
      case 'wareDelete' :
         index = action.index ;
         cart =state.cartList.splice(index,1);
         return Object.assign({},state,{
            cartList : [
               ...cart
            ]
         })
      break ;
      case 'appendToCartList'   :
      let product = action.product;
      cart = state.cartList ;
      let cartIndex = ArrayHasObject(cart,product,'productId') ;
      if(cartIndex < 0) {
         cart.push(product);
      }else {
         cart[cartIndex].vipShopColor = cart[cartIndex].vipShopColor.concat(product.vipShopColor)
         cart[cartIndex].vipShopSize = cart[cartIndex].vipShopSize.concat(product.vipShopSize)
         cart[cartIndex].vipShopNumber = cart[cartIndex].vipShopColor.length
      }
      return Object.assign({},state,{
         cartList :[
            ...cart
         ]
      })
   }
   return state
}

function ArrayHasObject (parent,child,key) {
   let i ;
   for(i = 0 ;i < parent.length; i++) {
      if(parent[i][key] == child[key]) {
         return i
      }
   }
   return -1
}

export default AdviceReduce;


